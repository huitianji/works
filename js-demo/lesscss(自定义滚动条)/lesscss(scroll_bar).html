<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title></title>
    <link rel="stylesheet" type="text/css" href="style/style.css">
    <script language="javascript" src="js/jquery1.10.2.min.js"></script>
</head>
<body>
<div class="box">
    <div class="parent"><div class="div1"></div></div>
    <div class="content-box">
        <ul class="ul-moving">
            <li>我的滚动条可以通过CSS自定义，这个就是自定义后的样子1111</li>
            <li>我的滚动条可以通过CSS自定义，这个就是自定义后的样子</li>
            <li>我的滚动条可以通过CSS自定义，这个就是自定义后的样子</li>
            <li>我的滚动条可以通过CSS自定义，这个就是自定义后的样子</li>

            <li>我的滚动条可以通过CSS自定义，这个就是自定义后的样子</li>
            <li>我的滚动条可以通过CSS自定义，这个就是自定义后的样子</li>
            <li>我的滚动条可以通过CSS自定义，这个就是自定义后的样子</li>
            <li>我的滚动条可以通过CSS自定义，这个就是自定义后的样子</li>

            <li>我的滚动条可以通过CSS自定义，这个就是自定义后的样子</li>
            <li>我的滚动条可以通过CSS自定义，这个就是自定义后的样子</li>
            <li>我的滚动条可以通过CSS自定义，这个就是自定义后的样子</li>
            <li>我的滚动条可以通过CSS自定义，这个就是自定义后的样子</li>


            <li>我的滚动条可以通过CSS自定义，这个就是自定义后的样子</li>
            <li>我的滚动条可以通过CSS自定义，这个就是自定义后的样子</li>
            <li>我的滚动条可以通过CSS自定义，这个就是自定义后的样子</li>
            <li>我的滚动条可以通过CSS自定义，这个就是自定义后的样子333</li>
        </ul>
    </div>
</div>
<div class="box">
    <div class="parent"><div class="div1"></div></div>
    <div class="content-box">
        <ul class="ul-moving">
            <li>我的滚动条可以通过CSS自定义，这个就是自定义后的样子</li>
            <li>我的滚动条可以通过CSS自定义，这个就是自定义后的样子</li>
            <li>我的滚动条可以通过CSS自定义，这个就是自定义后的样子</li>
            <li>我的滚动条可以通过CSS自定义，这个就是自定义后的样子</li>

            <li>我的滚动条可以通过CSS自定义，这个就是自定义后的样子</li>
            <li>我的滚动条可以通过CSS自定义，这个就是自定义后的样子</li>
            <li>我的滚动条可以通过CSS自定义，这个就是自定义后的样子</li>
            <li>我的滚动条可以通过CSS自定义，这个就是自定义后的样子</li>

            <li>我的滚动条可以通过CSS自定义，这个就是自定义后的样子</li>
            <li>我的滚动条可以通过CSS自定义，这个就是自定义后的样子</li>
            <li>我的滚动条可以通过CSS自定义，这个就是自定义后的样子</li>
            <li>我的滚动条可以通过CSS自定义，这个就是自定义后的样子</li>


            <li>我的滚动条可以通过CSS自定义，这个就是自定义后的样子</li>
            <li>我的滚动条可以通过CSS自定义，这个就是自定义后的样子</li>
            <li>我的滚动条可以通过CSS自定义，这个就是自定义后的样子</li>
            <li>我的滚动条可以通过CSS自定义，这个就是自定义后的样子</li>
        </ul>
    </div>
</div>
<div class="box">
    <div class="parent"><div class="div1"></div></div>
    <div class="content-box">
        <ul class="ul-moving">
            <li>我的滚动条可以通过CSS自定义，这个就是自定义后的样子</li>
            <li>我的滚动条可以通过CSS自定义，这个就是自定义后的样子</li>
            <li>我的滚动条可以通过CSS自定义，这个就是自定义后的样子</li>
            <li>我的滚动条可以通过CSS自定义，这个就是自定义后的样子</li>

            <li>我的滚动条可以通过CSS自定义，这个就是自定义后的样子</li>
            <li>我的滚动条可以通过CSS自定义，这个就是自定义后的样子</li>
            <li>我的滚动条可以通过CSS自定义，这个就是自定义后的样子</li>
            <li>我的滚动条可以通过CSS自定义，这个就是自定义后的样子</li>

            <li>我的滚动条可以通过CSS自定义，这个就是自定义后的样子</li>
            <li>我的滚动条可以通过CSS自定义，这个就是自定义后的样子</li>
            <li>我的滚动条可以通过CSS自定义，这个就是自定义后的样子</li>
            <li>我的滚动条可以通过CSS自定义，这个就是自定义后的样子</li>


            <li>我的滚动条可以通过CSS自定义，这个就是自定义后的样子</li>
            <li>我的滚动条可以通过CSS自定义，这个就是自定义后的样子</li>
            <li>我的滚动条可以通过CSS自定义，这个就是自定义后的样子</li>
            <li>我的滚动条可以通过CSS自定义，这个就是自定义后的样子</li>
        </ul>
    </div>
</div>
<script>
    function myAddEvent(obj,sEvent,fn){
        if(obj.addEventListener){
            obj.addEventListener(sEvent,fn,false);
        }else if(obj.attachEvent){
            obj.attachEvent("on"+sEvent,fn);
        }
    }
    function onMouseWheel(ev,oDiv,oParent,ulMoving,conBox){
        var oEvent = ev  || event;
        // IE  chrom
        //wheelDelta 上 正
        //-----------下 负
        //火狐下  detail  上   负
        //---------------下   正
        //alert(oEvent.wheelDelta);//ie下wheelDelta
//        console.log(oEvent.detail);
        var bDown = true;
        bDown = oEvent.wheelDelta ? oEvent.wheelDelta < 0 : oEvent.detail > 0;
//        console.log(bDown);
        if(bDown){
            //
            setTop(oDiv.offsetTop+10,oDiv,oParent,ulMoving,conBox);
        }else{
            //
            setTop(oDiv.offsetTop-10,oDiv,oParent,ulMoving,conBox);
        }
        if(oEvent.preventDefault){
            oEvent.preventDefault();//火狐里面阻止默认行为
        }
        return false;
    }
//    myAddEvent(document,"mousewheel",onMouseWheel);
//    myAddEvent(document,"DOMMouseScroll",onMouseWheel);
    function moveFunction(oDiv,oParent,ulMoving,conBox){
        oDiv.onmousedown = function(ev){
            var oEvent = ev || event;
            var dixY= oEvent.clientY - oDiv.offsetTop;
            document.onmousemove = function(ev){
                var oEvent = ev || event;
                var l = oEvent.clientY - dixY;
                setTop(l,oDiv,oParent,ulMoving,conBox);
            }
            document.onmouseup = function(ev){
                document.onmousemove = null;
                document.onmouseup = null;
            }
            return false;
        }
    }
    function setTop(l,oDiv,oParent,ulMoving,conBox){
        if(l < 0){
            l = 0;
        }else if(l > oParent.offsetHeight - oDiv.offsetHeight){
            l = oParent.offsetHeight - oDiv.offsetHeight;
        }
        oDiv.style.top = l + "px";
        //
        var scale = l / (oParent.offsetHeight - oDiv.offsetHeight);
        document.title = scale;
        ulMoving.style.top = -(ulMoving.offsetHeight - conBox.offsetHeight)*scale + "px";
    }
    ///////////////////////////////
//    var oDiv1 = $("#box0 .div1")[0];
//    var oParent1 = $("#box0 .parent")[0];
//    var ulMoving = $("#box0 .ul-moving")[0];
//    var conBox = $("#box0 .content-box")[0];
//    comBox(oDiv1,oParent1,ulMoving,conBox);
//    myAddEvent(oParent1,"mousewheel",function(ev){onMouseWheel(ev,oDiv1,oParent1,ulMoving,conBox);});
//    myAddEvent(oParent1,"DOMMouseScroll",function(ev){onMouseWheel(ev,oDiv1,oParent1,ulMoving,conBox);});
    ////////////////
    //
    var $box = $(".box");
    for(var i= 0,len = $box.length;i<len;i++){
        (function(){
            var oDiv = $box.eq(i).find(".div1")[0];
            var oParent = $box.eq(i).find(".parent")[0];
            var ulMoving = $box.eq(i).find(".ul-moving")[0];
            var contentBox = $box.eq(i).find(".content-box")[0];
            moveFunction(oDiv,oParent,ulMoving,contentBox);
            myAddEvent(oParent,"mousewheel",function(ev){onMouseWheel(ev,oDiv,oParent,ulMoving,contentBox);});
            myAddEvent(oParent,"DOMMouseScroll",function(ev){onMouseWheel(ev,oDiv,oParent,ulMoving,contentBox);});

            //////////算法：滚动条高度随内容的多少变化
            ///// x=oDiv,n=oParent,t=ulMoving,h=contentBox;
            ////h/t=x/n
            var h = contentBox.offsetHeight;
            var t = ulMoving.offsetHeight;
            var n = oParent.offsetHeight;
            var x;
            x = (h*n)/t;
            console.log(x);
            console.log(Math.ceil(x));
            oDiv.style.height = Math.ceil(x) + "px";
            ///////////////


        })(i)
    }
</script>
<script>
//    document.onkeydown = function(ev){
//        var oEvent = ev || event;
//        if(oEvent.keyCode == 38){
//           //
//        }
//        if(oEvent.keyCode == 40){
//            //
//        }
//        return false;
//    }
</script>
</body>
</html>